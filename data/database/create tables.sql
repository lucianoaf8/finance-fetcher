-- create tables.sql
CREATE TABLE plaid_accounts (
    id INT AUTO_INCREMENT PRIMARY KEY,
    account_id VARCHAR(255) NOT NULL UNIQUE,
    name VARCHAR(255),
    official_name VARCHAR(255),
    type VARCHAR(50),
    subtype VARCHAR(50),
    bank_name VARCHAR(50),
    access_token VARCHAR(255) NOT NULL,
    last_fetch_date DATE,
    INDEX (`access_token`),
    INDEX (`bank_name`)
);


CREATE TABLE `plaid_transactions` (
    `id` INT AUTO_INCREMENT PRIMARY KEY,
    `account_id` VARCHAR(255) NOT NULL,
    `transaction_id` VARCHAR(255) NOT NULL,
    `account_owner` VARCHAR(255),
    `amount` DECIMAL(10, 2) NOT NULL,
    `authorized_date` DATE,
    `authorized_datetime` DATETIME,
    `date` DATE NOT NULL,
    `datetime` DATETIME,
    `iso_currency_code` VARCHAR(3),
    `logo_url` VARCHAR(255),
    `merchant_entity_id` VARCHAR(255),
    `merchant_name` VARCHAR(255),
    `name` VARCHAR(255) NOT NULL,
    `payment_channel` VARCHAR(50),
    `pending` BOOLEAN,
    `pending_transaction_id` VARCHAR(255),
    `transaction_code` VARCHAR(255),
    `transaction_type` VARCHAR(50),
    `unofficial_currency_code` VARCHAR(3),
    `category` VARCHAR(255),
    `category_id` VARCHAR(255),
    `personal_finance_category_confidence_level` VARCHAR(255),
    `personal_finance_category_detailed` VARCHAR(255),
    `personal_finance_category_primary` VARCHAR(255),
    `personal_finance_category_icon_url` VARCHAR(255),
    `location_address` VARCHAR(255),
    `location_city` VARCHAR(255),
    `location_region` VARCHAR(255),
    `location_postal_code` VARCHAR(20),
    `location_country` VARCHAR(50),
    `location_lat` DECIMAL(10, 7),
    `location_lon` DECIMAL(10, 7),
    `location_store_number` VARCHAR(50),
    `payment_meta_reference_number` VARCHAR(255),
    `payment_meta_ppd_id` VARCHAR(255),
    `payment_meta_payee` VARCHAR(255),
    `payment_meta_by_order_of` VARCHAR(255),
    `payment_meta_payer` VARCHAR(255),
    `payment_meta_payment_method` VARCHAR(255),
    `payment_meta_payment_processor` VARCHAR(255),
    `payment_meta_reason` VARCHAR(255),
    `website` VARCHAR(255),
    `check_number` VARCHAR(255),
    `file_import_id` INT,
    `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX (`transaction_id`),
    INDEX (`account_id`),
    FOREIGN KEY (`file_import_id`) REFERENCES `file_import_tracker` (`id`)
);

CREATE TABLE `plaid_transactions_history` (
    `id` INT AUTO_INCREMENT PRIMARY KEY,
    `account_id` VARCHAR(255) NOT NULL,
    `transaction_id` VARCHAR(255) NOT NULL,
    `account_owner` VARCHAR(255),
    `amount` DECIMAL(10, 2) NOT NULL,
    `authorized_date` DATE,
    `authorized_datetime` DATETIME,
    `date` DATE NOT NULL,
    `datetime` DATETIME,
    `iso_currency_code` VARCHAR(3),
    `logo_url` VARCHAR(255),
    `merchant_entity_id` VARCHAR(255),
    `merchant_name` VARCHAR(255),
    `name` VARCHAR(255) NOT NULL,
    `payment_channel` VARCHAR(50),
    `pending` BOOLEAN,
    `pending_transaction_id` VARCHAR(255),
    `transaction_code` VARCHAR(255),
    `transaction_type` VARCHAR(50),
    `unofficial_currency_code` VARCHAR(3),
    `category` VARCHAR(255),
    `category_id` VARCHAR(255),
    `personal_finance_category_confidence_level` VARCHAR(255),
    `personal_finance_category_detailed` VARCHAR(255),
    `personal_finance_category_primary` VARCHAR(255),
    `personal_finance_category_icon_url` VARCHAR(255),
    `location_address` VARCHAR(255),
    `location_city` VARCHAR(255),
    `location_region` VARCHAR(255),
    `location_postal_code` VARCHAR(20),
    `location_country` VARCHAR(50),
    `location_lat` DECIMAL(10, 7),
    `location_lon` DECIMAL(10, 7),
    `location_store_number` VARCHAR(50),
    `payment_meta_reference_number` VARCHAR(255),
    `payment_meta_ppd_id` VARCHAR(255),
    `payment_meta_payee` VARCHAR(255),
    `payment_meta_by_order_of` VARCHAR(255),
    `payment_meta_payer` VARCHAR(255),
    `payment_meta_payment_method` VARCHAR(255),
    `payment_meta_payment_processor` VARCHAR(255),
    `payment_meta_reason` VARCHAR(255),
    `website` VARCHAR(255),
    `check_number` VARCHAR(255),
    `file_import_id` INT,
    `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX (`transaction_id`),
    INDEX (`account_id`),
    FOREIGN KEY (`file_import_id`) REFERENCES `file_import_tracker` (`id`)
);

CREATE TABLE `file_import_tracker` (
    `id` INT AUTO_INCREMENT PRIMARY KEY,
    `file_name` VARCHAR(255) NOT NULL,
    `description` TEXT,
    `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    INDEX (`file_name`)
);
